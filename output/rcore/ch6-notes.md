# CH6 NOTES

FOS

## 理论

### 文件和文件系统

- 文件
  - 文件概念
  - 文件操作
    - 以 linux 为例介绍文件系统的概念
    - 从内核的角度来看，它会将所有文件无差别的看成一个字节序列，文件内容的结构和含义则是交给对应的应用进行解析
    - 绝对路径和相对路径
    - 文件系统的作用
      - 用户视角：通过路径即可索引到文件并以字节流进行读写的用户视角有很大的不同
      - 系统视角：常规文件和目录都是实际保存在持久存储设备中的。持久存储设备仅支持以扇区（或块）为单位的随机读写
      - 中间转换的便是 文件系统 (File System) - 文件系统负责将逻辑上的目录树结构（包括其中每个文件或目录的数据和其他信息）映射到持久存储设备上，决定设备上的每个扇区应存储哪些内容
    - 多种文件系统 -> 虚拟文件系统
- 文件系统
  - 文件描述符
  - 文件系统的底层实现中都是对文件进行随机读写的
  - VFS
  - 目录
  - 文件别名
  - 文件系统的挂载
  
文件描述符在 PCB 中的体现
inode - 文件控制块
缓存置换算法
文件锁
文件内存分配
bitmap 空闲空间管理
分区

### 文件磁盘缓存

### 支持崩溃一致性可靠文件系统

- fsck 解决
- 日志方式
- 支持事务

## 实践

## 文件系统的设计与实现

- 文件系统存储结构
  - superblock
  - inode
  - bitmap
  - dir_entry
- 文件系统的加载流程
- 系统调用
  - open
  - close
  - write
  - read
  - seek offset
  
## 支持文件的操作系统 - FOS

- easyfs
- LRU 缓存算法 - 为什么对内存页置换算法不可行
- 之前没有文件系统可以加载应用，现在为什么需要文件系统
- sys_read write offset 在操作系统层面保存
- 基于文件加载应用程序
- 算出能放多少文件
- 实验：文件系统支持软连接